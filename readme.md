# KdicSetup - GUI PC 초기화 자동화 프로그램

KdicSetup은 Windows PC의 포맷, 운영체제 설치, 드라이버 및 기본 설정까지의 복잡한 초기화 과정을 자동화하는 PyQt6 기반의 GUI 애플리케이션입니다. 사용자는 간단한 UI를 통해 원하는 옵션을 선택하고 클릭 한 번으로 PC 설정을 완료할 수 있습니다.

### 목차
1. [주요 기능](#1-주요-기능)
2. [실행 환경 및 사전 요구사항](#2-실행-환경-및-사전-요구사항)
3. [사용 방법](#3-사용-방법)
4. [아키텍처](#4-아키텍처)
5. [프로젝트 구조](#5-프로젝트-구조)
6. [핵심 컴포넌트 상세](#6-핵심-컴포넌트-상세)
7. [유지보수 가이드](#7-유지보수-가이드)

---

## 1. 주요 기능
* 🖥️ **사용자 친화적 GUI:** 직관적인 인터페이스로 모든 작업을 쉽게 제어할 수 있습니다.
* 🔍 **자동 시스템 분석:** 프로그램 시작 시 디스크, 볼륨, 메인보드 등 하드웨어 정보를 자동으로 분석합니다.
* ⚙️ **맞춤형 초기화:** PC 용도(내부망, 인터넷, 출장용 등)에 따른 맞춤형 이미지 설치를 지원합니다.
* 💾 **데이터 보존 옵션:** 사용자 데이터를 삭제하지 않고 운영체제만 안전하게 재설치할 수 있습니다.
* 🚀 **완전 자동화:** 포맷, 이미지 적용(WIM), 드라이버 설치, 부팅 구성까지 모든 과정을 자동으로 수행합니다.
* 📊 **실시간 피드백:** 진행률 표시줄, 예상 남은 시간, 상세 로그를 통해 작업 현황을 실시간으로 확인할 수 있습니다.

## 2. 실행 환경 및 사전 요구사항
### 2.1. 실행 환경
* **운영체제:** Windows 10 이상
* **필수 라이브러리:**
    * PyQt6
    * wmi
    * pywin32

### 2.2. 사전 요구사항
* **관리자 권한:** `diskpart`, `DISM` 등 시스템 명령어를 사용하므로 반드시 관리자 권한으로 실행해야 합니다.
* **폴더 구조:** 프로그램이 올바르게 동작하려면 아래와 같은 폴더 구조를 유지해야 합니다.
    ```
    /C:/KdicSetup/  (<- 루트 폴더)
    ├── KdicSetup/
    │   ├── KdicSetup.exe  (<- 실행 파일)
    │   └── ...
    ├── wim/
    │   ├── work.wim
    │   ├── internet.wim
    │   └── ...
    └── Drivers/
        ├── P8H61-M-PRO-ASUS-2103/ (<- 메인보드 모델명)
        │   ├── ... (드라이버 파일들) ...
        └── ...
    ```

## 3. 사용 방법
1. `KdicSetup.exe`를 관리자 권한으로 실행합니다.
2. 프로그램이 자동으로 시스템을 분석할 때까지 잠시 기다립니다.
3. **[타입 선택]** 에서 원하는 PC 용도를 선택합니다.
4. **[데이터 보존]** 여부를 선택합니다. (환경에 따라 비활성화될 수 있음)
5. **[시작]** 버튼을 클릭합니다.
    * '데이터 보존'을 선택하지 않은 경우, 데이터 삭제 확인을 위해 암호(`960601`)를 입력해야 합니다.
6. 자동으로 작업이 진행되며, 완료 후 재부팅 확인 창이 나타납니다.
7. 확인 시 10초 후 자동으로 재부팅됩니다.

## 4. 아키텍처
본 프로그램은 **MVC(Model-View-Controller) 패턴**을 기반으로 하며, UI 반응성을 유지하기 위해 **멀티스레딩**을 사용합니다.

* **View (view.py):** 사용자 인터페이스(UI)를 담당하며, 사용자 입력을 Controller로 전달합니다.
* **Controller (controller.py):** View와 백그라운드 작업(Model, Worker) 간의 상호작용을 제어하는 중재자 역할을 합니다.
* **Model (models.py):** `Options`, `SystemInfo` 등 프로그램에서 사용하는 데이터 구조를 정의합니다.
* **Background Threads (loader.py, worker.py):** 시스템 분석 및 PC 초기화처럼 시간이 오래 걸리는 작업을 별도의 스레드에서 처리하여 UI 멈춤 현상을 방지합니다.

## 5. 프로젝트 구조

KdicSetup/
├── KdicSetup.py         # 메인 실행 파일 (Entry Point)
├── view.py              # UI 로직
├── controller.py        # 메인 제어 로직
├── loader.py            # 시스템 분석 스레드
├── worker.py            # 실제 작업 수행 스레드
├── models.py            # 데이터 모델 (dataclasses)
├── utils.py             # 유틸리티 함수 (명령어 실행 등)
├── dialog.py            # 사용자 확인 대화상자
├── logger.py            # 로깅 시스템 설정
└── .gitignore           # Git 버전 관리 제외 목록


## 6. 핵심 컴포넌트 상세
<details>
    <summary><b>Loader.py - 시스템 분석기</b></summary>
    <ul>
        <li><code>diskpart</code> 명령으로 디스크 및 볼륨 정보를 수집합니다.</li>
        <li>USB 디스크를 제외하고, 폴더 구조를 기반으로 System, Data, Boot 볼륨을 자동으로 분류합니다.</li>
        <li>WMI를 통해 메인보드 모델명을 조회하고, <code>../Drivers/</code> 에서 일치하는 드라이버 폴더 경로를 찾습니다.</li>
        <li>분석된 모든 정보를 <code>SystemInfo</code> 객체에 담아 Controller로 전달합니다.</li>
    </ul>
</details>
<details>
    <summary><b>Worker.py - 자동화 작업자</b></summary>
    <ul>
        <li>사용자 옵션에 따라 <code>diskpart</code> 스크립트를 동적으로 생성하여 디스크 포맷 및 파티션 생성을 수행합니다.</li>
        <li><code>DISM</code> 명령으로 선택된 WIM 이미지를 OS 파티션에 적용하고, 드라이버를 통합 설치합니다.</li>
        <li><code>robocopy</code>를 이용해 사용자 폴더 등 기타 설정 파일들을 복원합니다.</li>
        <li><code>bcdboot</code>, <code>bcdedit</code> 명령으로 UEFI 부팅 정보를 구성합니다.</li>
    </ul>
</details>
<details>
    <summary><b>Controller.py - 중앙 통제 장치</b></summary>
    <ul>
        <li>View로부터의 사용자 입력(시그널)을 받아 Loader나 Worker 스레드를 시작/중지시킵니다.</li>
        <li>Loader와 Worker로부터 진행률, 로그, 완료/오류 상태를 받아 View에 업데이트합니다.</li>
        <li>작업 완료 후 실제 소요 시간을 파일에 저장하여 다음 실행 시 '예상 남은 시간'의 정확도를 높입니다.</li>
    </ul>
</details>

## 7. 유지보수 가이드
### 7.1. WIM 이미지 관리
* **경로:** `../wim/`
* PC 타입 추가 또는 이미지 업데이트 시, 해당 폴더에 `.wim` 파일을 추가/교체하세요.
* **코드 수정:** 새 타입을 추가하는 경우, `worker.py`의 `wim_map`과 `view.py`의 `buttons` 딕셔너리를 수정해야 합니다.

### 7.2. 드라이버 관리
* **경로:** `../Drivers/`
* 새 PC 모델의 드라이버를 추가하려면, `[메인보드 모델명]`으로 시작하는 폴더를 생성하고 내부에 드라이버 파일을 위치시키세요.
* **참고:** 모델명은 WMI 조회 결과와 일치해야 정확히 인식됩니다.

### 7.3. 디버깅
* 프로그램 실행 시 생성되는 `log.txt` 파일을 확인하면 모든 작업의 상세 과정과 오류 내역을 파악할 수 있습니다.

### 7.4. 설정 변경
* **데이터 삭제 확인 암호:** `dialog.py`의 `ConfirmationDialog` 클래스 내 `_validate_input` 메소드에서 변경할 수 있습니다.
* **기본 예상 시간:** `controller.py`의 `start_automation` 메소드에서 디스크 타입별(NVMe, SSD, HDD) 기본 예상 시간을 조정할 수 있습니다.